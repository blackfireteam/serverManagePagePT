(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["appManage"],{"534d":function(e,t,n){"use strict";n.r(t);n("d3b7"),n("b0c0"),n("e9c4"),n("7db0");var c=n("7a23"),o=n("5530"),a=n("866a"),i=n("a87f"),r=n("99cb"),l=n("44a6"),u={class:"dialog-footer"},d=Object(c["createTextVNode"])("取 消"),p=Object(c["createTextVNode"])("确 定"),b=Object(c["defineComponent"])({emits:["submit"],setup:function(e,t){var n=t.expose,b=t.emit,f=Object(c["getCurrentInstance"])().appContext.config.globalProperties,s=Object(c["reactive"])({email:""});n({open:j});var O=Object(c["ref"])(!1),m=Object(c["ref"])();function j(e){m.value=e,O.value=!0}var g=Object(c["ref"])();function v(){O.value=!1,g.value.clearValidate(),s.email=""}function h(){var e={appId:m.value,email:s.email},t=f.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});Object(a["d"])(r["AppAssign"],i["d"].AppAssign,e).then((function(t){var n=JSON.parse(t.msg);b("submit",Object(o["a"])(Object(o["a"])({},e),{},{id:n.id})),Object(l["d"])(f.$message,"设置App管理员成功","success"),O.value=!1})).catch((function(e){Object(l["d"])(f.$message,"设置失败：".concat(e.msg||""))})).finally((function(){t.close()}))}return function(e,t){var n=Object(c["resolveComponent"])("el-input"),o=Object(c["resolveComponent"])("el-form-item"),a=Object(c["resolveComponent"])("el-form"),i=Object(c["resolveComponent"])("el-button"),r=Object(c["resolveComponent"])("el-dialog");return Object(c["openBlock"])(),Object(c["createBlock"])(r,{modelValue:O.value,"onUpdate:modelValue":t[1]||(t[1]=function(e){return O.value=e}),width:"400px",title:"设置App管理员",onClose:v},{footer:Object(c["withCtx"])((function(){return[Object(c["createElementVNode"])("span",u,[Object(c["createVNode"])(i,{size:"small",onClick:v},{default:Object(c["withCtx"])((function(){return[d]})),_:1}),Object(c["createVNode"])(i,{size:"small",type:"primary",onClick:h},{default:Object(c["withCtx"])((function(){return[p]})),_:1})])]})),default:Object(c["withCtx"])((function(){return[Object(c["createVNode"])(a,{model:Object(c["unref"])(s),ref_key:"fromRef",ref:g,size:"small",labelWidth:"60px"},{default:Object(c["withCtx"])((function(){return[Object(c["createVNode"])(o,{label:"email："},{default:Object(c["withCtx"])((function(){return[Object(c["createVNode"])(n,{modelValue:Object(c["unref"])(s).email,"onUpdate:modelValue":t[0]||(t[0]=function(e){return Object(c["unref"])(s).email=e}),autocomplete:"off",clearable:""},null,8,["modelValue"])]})),_:1})]})),_:1},8,["model"])]})),_:1},8,["modelValue"])}}});const f=b;var s=f,O=n("6c02"),m=n("0613"),j=function(e){return Object(c["pushScopeId"])("data-v-aabd51b4"),e=e(),Object(c["popScopeId"])(),e},g={class:"app_manage"},v={class:"title_wrapper"},h={class:"title"},C=j((function(){return Object(c["createElementVNode"])("span",{class:"title_text"},"App管理",-1)})),k={class:"main_wrapper"},N=Object(c["createTextVNode"])(" 管理 "),V=Object(c["createTextVNode"])(" 取消App管理员 "),x=Object(c["createTextVNode"])(" 设置App管理员 "),w=Object(c["defineComponent"])({setup:function(e){var t=Object(c["getCurrentInstance"])().appContext.config.globalProperties,n=Object(O["d"])(),o=Object(c["computed"])((function(){return m["a"].state.userInfo})),u=Object(c["ref"])([]);function d(){var e=t.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});Object(a["d"])(r["AppList"],i["d"].AppList).then((function(e){u.value=JSON.parse(e.msg)})).catch((function(e){})).finally((function(){e.close()}))}function p(e){var u=t.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});Object(a["d"])(r["AppCheckout"],i["d"].AppCheckout,{appId:e.id}).then((function(a){Object(l["d"])(t.$message,"checkOut App 成功","success");var i={appId:e.id,appTitle:e.name,managerEmail:e.email};m["a"].commit("setAppInfo",i),window.sessionStorage.setItem("appInfo",JSON.stringify(i)),o.value.isStaff?b(u):(u.close(),Object(c["nextTick"])((function(){n.push({name:"appState"})})))})).catch((function(e){u.close(),Object(l["d"])(t.$message,"checkOut App 失败：".concat(e.msg||""))}))}function b(e){Object(a["d"])(r["StaffInfo"],i["d"].StaffInfo).then((function(e){m["a"].commit("setStaffInfo",JSON.parse(e.msg)),Object(c["nextTick"])((function(){n.push({name:"appState"})}))})).catch((function(e){Object(l["d"])(t.$message,"获取Staff权限信息失败：".concat(e.msg||""))})).finally((function(){e.close()}))}Object(c["onMounted"])((function(){d()}));var f=Object(c["ref"])();function j(e){f.value.open(e)}function w(e){var t=u.value.find((function(t){return t.id===e.appId}));t&&(t.email=e.email,t.uid=e.id)}function _(e){var n={appId:e.id,del:!0},c=t.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});Object(a["d"])(r["AppAssign"],i["d"].AppAssign,n).then((function(n){e.uid=void 0,e.email="",Object(l["d"])(t.$message,"操作成功","success")})).catch((function(e){Object(l["d"])(t.$message,"取消管理员失败：".concat(e.msg||""))})).finally((function(){c.close()}))}return function(e,t){var n=Object(c["resolveComponent"])("el-button"),a=Object(c["resolveComponent"])("el-tooltip"),i=Object(c["resolveComponent"])("el-table-column"),r=Object(c["resolveComponent"])("el-table");return Object(c["openBlock"])(),Object(c["createElementBlock"])(c["Fragment"],null,[Object(c["createElementVNode"])("div",g,[Object(c["createElementVNode"])("div",v,[Object(c["createElementVNode"])("div",h,[C,Object(c["createVNode"])(a,{effect:"dark",content:"刷新",placement:"bottom"},{default:Object(c["withCtx"])((function(){return[Object(c["createVNode"])(n,{size:"mini",class:"refresh_btn",type:"text",icon:"el-icon-refresh",onClick:t[0]||(t[0]=function(e){return d()}),circle:""})]})),_:1})])]),Object(c["createElementVNode"])("div",k,[Object(c["createVNode"])(r,{data:u.value,border:"",maxHeight:"650px"},{default:Object(c["withCtx"])((function(){return[Object(c["createVNode"])(i,{prop:"id",label:"AppID",minWidth:"80"}),Object(c["createVNode"])(i,{prop:"name",label:"AppName",minWidth:"150"}),Object(c["unref"])(o).isStaff?Object(c["createCommentVNode"])("",!0):(Object(c["openBlock"])(),Object(c["createBlock"])(i,{key:0,prop:"uid",label:"管理员id",minWidth:"160"},{default:Object(c["withCtx"])((function(e){return[Object(c["createTextVNode"])(Object(c["toDisplayString"])(e.row.uid?e.row.uid:""),1)]})),_:1})),Object(c["unref"])(o).isStaff?Object(c["createCommentVNode"])("",!0):(Object(c["openBlock"])(),Object(c["createBlock"])(i,{key:1,prop:"email",label:"管理员邮箱",minWidth:"170"})),Object(c["createVNode"])(i,{prop:"total_reg_count",label:"总用户数",minWidth:"80"}),Object(c["createVNode"])(i,{prop:"total_msg_count",label:"总消息数",minWidth:"80"}),Object(c["createVNode"])(i,{label:"操作",minWidth:"220"},{default:Object(c["withCtx"])((function(e){return[Object(c["createVNode"])(n,{type:"primary",size:"mini",onClick:function(t){return p(e.row)}},{default:Object(c["withCtx"])((function(){return[N]})),_:2},1032,["onClick"]),Object(c["unref"])(o).userManage&&e.row.email?(Object(c["openBlock"])(),Object(c["createBlock"])(n,{key:0,type:"danger",size:"mini",onClick:function(t){return _(e.row)}},{default:Object(c["withCtx"])((function(){return[V]})),_:2},1032,["onClick"])):Object(c["unref"])(o).userManage?(Object(c["openBlock"])(),Object(c["createBlock"])(n,{key:1,type:"primary",size:"mini",onClick:function(t){return j(e.row.id)}},{default:Object(c["withCtx"])((function(){return[x]})),_:2},1032,["onClick"])):Object(c["createCommentVNode"])("",!0)]})),_:1})]})),_:1},8,["data"])])]),Object(c["createVNode"])(s,{ref_key:"appAdminDialog",ref:f,onSubmit:w},null,512)],64)}}}),_=(n("a57e"),n("6b0d")),A=n.n(_);const y=A()(w,[["__scopeId","data-v-aabd51b4"]]);t["default"]=y},"6b0d":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t)=>{const n=e.__vccOpts||e;for(const[c,o]of t)n[c]=o;return n}},"98fe":function(e,t,n){},a57e:function(e,t,n){"use strict";n("98fe")},e9c4:function(e,t,n){var c=n("23e7"),o=n("da84"),a=n("d066"),i=n("2ba4"),r=n("e330"),l=n("d039"),u=o.Array,d=a("JSON","stringify"),p=r(/./.exec),b=r("".charAt),f=r("".charCodeAt),s=r("".replace),O=r(1..toString),m=/[\uD800-\uDFFF]/g,j=/^[\uD800-\uDBFF]$/,g=/^[\uDC00-\uDFFF]$/,v=function(e,t,n){var c=b(n,t-1),o=b(n,t+1);return p(j,e)&&!p(g,o)||p(g,e)&&!p(j,c)?"\\u"+O(f(e,0),16):e},h=l((function(){return'"\\udf06\\ud834"'!==d("\udf06\ud834")||'"\\udead"'!==d("\udead")}));d&&c({target:"JSON",stat:!0,forced:h},{stringify:function(e,t,n){for(var c=0,o=arguments.length,a=u(o);c<o;c++)a[c]=arguments[c];var r=i(d,null,a);return"string"==typeof r?s(r,m,v):r}})}}]);